{% extends 'layouts/base.html' %}
{% load static %}

{% block content %}
{% include 'includes/pre-loader.html' %}

<div class="content-container container mt-10">
    <h1 class="mb-4 text-center">Cybersecurity Quiz & Code Challenges</h1>
    <p class="text-center mb-5">
        Test your knowledge with our interactive cybersecurity quiz and coding challenges. Answer questions, write code, and track your progress!
    </p>

    <!-- Quiz Section -->
    <div class="quiz-container mb-5">
        <div class="card shadow-lg cyber-card">
            <div class="card-header bg-primary text-white cyber-header">
                <h3 class="mb-0">Quick Cybersecurity Quiz</h3>
                <div class="cyber-particles"></div>
            </div>
            <div class="card-body cyber-body">
                <div class="quiz-progress mb-3">
                    <div class="progress">
                        <div class="progress-bar cyber-progress" role="progressbar" style="width: 0%"></div>
                    </div>
                    <div class="progress-text">Question <span id="current-question">1</span> of <span id="total-questions">5</span></div>
                </div>
                
                <div class="score-display mb-3">
                    <span class="badge bg-success cyber-score">Score: <span id="score">0</span></span>
                </div>

                <div id="question-container">
                    <h4 id="question-text" class="mb-4 cyber-text"></h4>
                    <div id="options-container" class="mb-4"></div>
                    <button id="next-btn" class="btn btn-primary cyber-btn" disabled>Next Question</button>
                </div>

                <div id="result-container" class="text-center" style="display: none;">
                    <div class="cyber-trophy mb-4">
                        <div class="trophy-cup"></div>
                        <div class="trophy-base"></div>
                    </div>
                    <h3 class="cyber-text">Quiz Complete!</h3>
                    <p class="cyber-text">Your final score: <span id="final-score">0</span> out of <span id="max-score">0</span></p>
                    <div id="feedback" class="mb-4"></div>
                    <div class="result-actions mb-4">
                        <button id="restart-btn" class="btn btn-primary cyber-btn me-3">
                            <i class="fas fa-redo me-1"></i>Restart Quiz
                        </button>
                        <a href="{% url 'leaderboard' %}" class="btn btn-success cyber-btn">
                            <i class="fas fa-trophy me-1"></i>View Leaderboard
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Code Challenge Section -->
    <div class="code-challenge-container mb-5">
        <div class="card shadow-lg cyber-card">
            <div class="card-header bg-success text-white cyber-header">
                <h3 class="mb-0">Code Challenge</h3>
                <div class="cyber-particles"></div>
            </div>
            <div class="card-body cyber-body">
                <div class="challenge-selector mb-4">
                    <label for="challenge-type" class="form-label cyber-text">Select Challenge Type:</label>
                    <select id="challenge-type" class="form-select cyber-select">
                        <option value="python">Python Challenge</option>
                        <option value="javascript">JavaScript Challenge</option>
                        <option value="sql">SQL Challenge</option>
                    </select>
                </div>

                <div id="code-challenge-content">
                    <div class="challenge-description mb-3">
                        <h5 class="cyber-text">Challenge Description:</h5>
                        <p id="challenge-desc" class="cyber-text"></p>
                    </div>

                    <div class="code-editor-container mb-3">
                        <div class="editor-header mb-2">
                            <label class="form-label cyber-text">Write Your Code:</label>
                            <div class="editor-controls">
                                <button id="run-code-btn" class="btn btn-success cyber-btn me-2">
                                    <i class="fas fa-play me-1"></i>Run Code
                                </button>
                                <button id="reset-code-btn" class="btn btn-warning cyber-btn">
                                    <i class="fas fa-undo me-1"></i>Reset
                                </button>
                            </div>
                        </div>
                        <div id="code-editor" class="code-editor"></div>
                    </div>

                    <div class="output-container mb-3">
                        <label class="form-label cyber-text">Output:</label>
                        <div id="output-console" class="output-console"></div>
                    </div>

                    <div class="test-cases mb-3">
                        <h6 class="cyber-text">Test Cases:</h6>
                        <div id="test-results"></div>
                    </div>

                    <div class="challenge-actions">
                        <button id="submit-challenge-btn" class="btn btn-primary cyber-btn" disabled>
                            <i class="fas fa-check me-1"></i>Submit Solution
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.cyber-card {
    border: 2px solid #00ff00;
    background: linear-gradient(135deg, #1a1a1a, #2d2d2d);
    color: #ffffff;
    transition: all 0.3s ease;
}

.cyber-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 25px rgba(0, 255, 0, 0.3);
}

.cyber-header {
    background: linear-gradient(135deg, #00ff00, #00cc00) !important;
    border-bottom: 2px solid #00ff00;
}

.cyber-body {
    background: linear-gradient(135deg, #1a1a1a, #2d2d2d);
}

.cyber-text {
    color: #ffffff;
    text-shadow: 0 0 10px rgba(0, 255, 0, 0.5);
}

.cyber-btn {
    background: linear-gradient(135deg, #00ff00, #00cc00);
    border: 2px solid #00ff00;
    color: #000000;
    font-weight: bold;
    transition: all 0.3s ease;
}

.cyber-btn:hover {
    background: linear-gradient(135deg, #00cc00, #009900);
    transform: scale(1.05);
    box-shadow: 0 5px 15px rgba(0, 255, 0, 0.4);
}

.cyber-select {
    background: #2d2d2d;
    border: 2px solid #00ff00;
    color: #ffffff;
}

.cyber-select:focus {
    background: #2d2d2d;
    border-color: #00ff00;
    color: #ffffff;
    box-shadow: 0 0 10px rgba(0, 255, 0, 0.3);
}

.cyber-progress {
    background: linear-gradient(90deg, #00ff00, #00cc00);
    height: 8px;
    border-radius: 4px;
}

.cyber-score {
    background: linear-gradient(135deg, #00ff00, #00cc00) !important;
    color: #000000 !important;
    font-weight: bold;
    padding: 8px 16px;
    border-radius: 20px;
}

.option-btn {
    background: linear-gradient(135deg, #2d2d2d, #3d3d3d);
    border: 2px solid #00ff00;
    color: #ffffff;
    padding: 15px 20px;
    margin: 5px;
    border-radius: 10px;
    cursor: pointer;
    transition: all 0.3s ease;
    font-weight: bold;
}

.option-btn:hover {
    background: linear-gradient(135deg, #00ff00, #00cc00);
    color: #000000;
    transform: scale(1.05);
}

.option-btn.selected {
    background: linear-gradient(135deg, #00ff00, #00cc00);
    color: #000000;
    box-shadow: 0 0 20px rgba(0, 255, 0, 0.6);
}

.option-btn.correct {
    background: linear-gradient(135deg, #00ff00, #00cc00);
    color: #000000;
    animation: correct-answer 0.5s;
}

.option-btn.incorrect {
    background: linear-gradient(135deg, #ff0000, #cc0000);
    color: #ffffff;
    animation: incorrect-answer 0.5s;
}

.code-editor {
    background: #1e1e1e;
    border: 2px solid #00ff00;
    border-radius: 10px;
    min-height: 300px;
    font-family: 'Courier New', monospace;
    color: #ffffff;
    padding: 15px;
    font-size: 14px;
    line-height: 1.5;
    overflow-y: auto;
}

.output-console {
    background: #1e1e1e;
    border: 2px solid #00ff00;
    border-radius: 10px;
    min-height: 150px;
    font-family: 'Courier New', monospace;
    color: #00ff00;
    padding: 15px;
    font-size: 14px;
    line-height: 1.5;
    overflow-y: auto;
}

.test-results {
    background: #2d2d2d;
    border: 1px solid #00ff00;
    border-radius: 8px;
    padding: 10px;
    margin: 5px 0;
}

.test-pass {
    border-color: #00ff00;
    background: rgba(0, 255, 0, 0.1);
}

.test-fail {
    border-color: #ff0000;
    background: rgba(255, 0, 0, 0.1);
}

.celebration {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 3rem;
    animation: celebration-bounce 1s ease;
}

@keyframes celebration-bounce {
    0%, 20%, 50%, 80%, 100% { transform: translate(-50%, -50%) scale(1); }
    40% { transform: translate(-50%, -50%) scale(1.2); }
    60% { transform: translate(-50%, -50%) scale(1.1); }
}

@keyframes correct-answer {
    0% { transform: scale(1); }
    50% { transform: scale(1.1); }
    100% { transform: scale(1); }
}

@keyframes incorrect-answer {
    0% { transform: translateX(0); }
    25% { transform: translateX(-10px); }
    75% { transform: translateX(10px); }
    100% { transform: translateX(0); }
}

@keyframes cyber-pulse {
    0% { box-shadow: 0 0 5px rgba(0, 255, 0, 0.5); }
    50% { box-shadow: 0 0 20px rgba(0, 255, 0, 0.8); }
    100% { box-shadow: 0 0 5px rgba(0, 255, 0, 0.5); }
}

.cyber-particles {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
}

.particle {
    position: absolute;
    width: 2px;
    height: 2px;
    background: #00ff00;
    border-radius: 50%;
    animation: particle-fall 3s linear infinite;
}

@keyframes particle-fall {
    0% {
        transform: translateY(-100%);
        opacity: 0;
    }
    50% {
        opacity: 1;
    }
    100% {
        transform: translateY(100%);
        opacity: 0;
    }
}

.cyber-trophy {
    position: relative;
    width: 80px;
    height: 80px;
    margin: 0 auto;
}

.trophy-cup {
    width: 40px;
    height: 50px;
    background: linear-gradient(45deg, #ffd700, #ffa500);
    border-radius: 50% 50% 0 0;
    position: absolute;
    top: 0;
    left: 50%;
    transform: translateX(-50%);
    box-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
}

.trophy-base {
    width: 30px;
    height: 20px;
    background: linear-gradient(45deg, #ffd700, #ffa500);
    position: absolute;
    bottom: 0;
    left: 50%;
    transform: translateX(-50%);
    border-radius: 5px;
}
</style>

<!-- Include CodeMirror for syntax highlighting -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/theme/monokai.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/python/python.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/javascript/javascript.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/sql/sql.min.js"></script>

<script>
// Quiz Data
const quizData = [
    {
        question: "What is the most common type of cyber attack?",
        options: {
            a: "Phishing",
            b: "DDoS",
            c: "SQL Injection",
            d: "Zero-day Exploit"
        },
        correct: "a",
        explanation: "Phishing is the most common type of cyber attack, where attackers trick users into revealing sensitive information."
    },
    {
        question: "What does VPN stand for?",
        options: {
            a: "Virtual Private Network",
            b: "Very Private Network",
            c: "Virtual Public Network",
            d: "Verified Private Network"
        },
        correct: "a",
        explanation: "VPN stands for Virtual Private Network, which creates a secure connection over the internet."
    },
    {
        question: "What is the purpose of a firewall?",
        options: {
            a: "To prevent unauthorized access",
            b: "To increase internet speed",
            c: "To store files securely",
            d: "To encrypt data"
        },
        correct: "a",
        explanation: "A firewall's main purpose is to prevent unauthorized access to or from a private network."
    },
    {
        question: "What is two-factor authentication?",
        options: {
            a: "Using two different passwords",
            b: "A security process requiring two forms of identification",
            c: "Having two security questions",
            d: "Using two different devices"
        },
        correct: "b",
        explanation: "Two-factor authentication requires two different forms of identification to verify a user's identity."
    },
    {
        question: "What is the best practice for creating strong passwords?",
        options: {
            a: "Using personal information",
            b: "Using the same password for all accounts",
            c: "Using a combination of letters, numbers, and symbols",
            d: "Writing passwords down"
        },
        correct: "c",
        explanation: "Strong passwords should include a combination of uppercase and lowercase letters, numbers, and special symbols."
    }
];

// Code Challenge Data
const codeChallenges = {
    python: {
        title: "Python Security Challenge",
        description: "Write a function to validate if a password meets security requirements. The password must be at least 8 characters long, contain at least one uppercase letter, one lowercase letter, one number, and one special character.",
        starterCode: `def validate_password(password):
    # Your code here
    pass

# Test your function
test_password = "SecurePass123!"
result = validate_password(test_password)
print(f"Password validation result: {result}")`,
        testCases: [
            { input: "SecurePass123!", expected: true },
            { input: "weak", expected: false },
            { input: "NoSpecialChar123", expected: false },
            { input: "nouppercase123!", expected: false }
        ],
        solution: `def validate_password(password):
    if len(password) < 8:
        return False
    
    has_upper = any(c.isupper() for c in password)
    has_lower = any(c.islower() for c in password)
    has_digit = any(c.isdigit() for c in password)
    has_special = any(c in "!@#$%^&*()_+-=[]{}|;':\",./<>?" for c in password)
    
    return has_upper and has_lower and has_digit and has_special`
    },
    javascript: {
        title: "JavaScript Security Challenge",
        description: "Create a function to sanitize user input by removing potentially dangerous HTML tags and scripts.",
        starterCode: `function sanitizeInput(input) {
    // Your code here
}

// Test your function
const testInput = '<script>console.log("xss")</script>Hello World!';
const result = sanitizeInput(testInput);
console.log(result);`,
        testCases: [
            { input: '<script>console.log("xss")</script>Hello World!', expected: 'Hello World!' },
            { input: '<p>Safe text</p>', expected: 'Safe text' },
            { input: 'Normal text without tags', expected: 'Normal text without tags' },
            { input: '<img src="x" onerror="console.log(1)">', expected: '' }
        ],
        solution: `function sanitizeInput(input) {
    return input.replace(/<[^>]*>/g, '');
}`
    },
    sql: {
        title: "SQL Security Challenge",
        description: "Write a secure SQL query that prevents SQL injection by using parameterized queries. Create a function that safely retrieves user data by username.",
        starterCode: `-- Your secure SQL query here
-- Use parameterized queries to prevent SQL injection

-- Example unsafe query (DO NOT USE):
-- SELECT * FROM users WHERE username = '${username}'

-- Your secure query:`,
        testCases: [
            { input: "admin", expected: "SELECT * FROM users WHERE username = ?" },
            { input: "'; DROP TABLE users; --", expected: "SELECT * FROM users WHERE username = ?" },
            { input: "user123", expected: "SELECT * FROM users WHERE username = ?" }
        ],
        solution: `-- Secure parameterized query
SELECT * FROM users WHERE username = ?`
    }
};

// Quiz Variables
let currentQuestion = 0;
let score = 0;
let selectedOption = null;

// Code Editor Variables
let codeEditor;
let currentLanguage = 'python';

// DOM Elements
const questionText = document.getElementById('question-text');
const optionsContainer = document.getElementById('options-container');
const nextButton = document.getElementById('next-btn');
const progressBar = document.querySelector('.progress-bar');
const currentQuestionSpan = document.getElementById('current-question');
const totalQuestionsSpan = document.getElementById('total-questions');
const scoreSpan = document.getElementById('score');
const resultContainer = document.getElementById('result-container');
const finalScoreSpan = document.getElementById('final-score');
const maxScoreSpan = document.getElementById('max-score');
const feedbackDiv = document.getElementById('feedback');
const restartButton = document.getElementById('restart-btn');

// Code Challenge Elements
const challengeTypeSelect = document.getElementById('challenge-type');
const challengeDesc = document.getElementById('challenge-desc');
const runCodeBtn = document.getElementById('run-code-btn');
const resetCodeBtn = document.getElementById('reset-code-btn');
const outputConsole = document.getElementById('output-console');
const testResults = document.getElementById('test-results');
const submitChallengeBtn = document.getElementById('submit-challenge-btn');

// Initialize Quiz
function initQuiz() {
    loadQuestion();
    createParticles();
}

// Initialize Code Editor
function initCodeEditor() {
    codeEditor = CodeMirror(document.getElementById('code-editor'), {
        mode: 'python',
        theme: 'monokai',
        lineNumbers: true,
        autoCloseBrackets: true,
        matchBrackets: true,
        indentUnit: 4,
        tabSize: 4,
        lineWrapping: true,
        extraKeys: {
            "Tab": function(cm) {
                cm.replaceSelection("    ", "end");
            }
        }
    });
    
    loadCodeChallenge('python');
}

// Load Quiz Question
function loadQuestion() {
    const question = quizData[currentQuestion];
    questionText.textContent = question.question;
    
    optionsContainer.innerHTML = '';
    Object.entries(question.options).forEach(([key, value]) => {
        const button = document.createElement('button');
        button.className = 'option-btn';
        button.textContent = value;
        button.dataset.option = key;
        button.addEventListener('click', selectOption);
        optionsContainer.appendChild(button);
    });

    nextButton.disabled = true;
    selectedOption = null;
    updateProgress();
}

// Select Quiz Option
function selectOption(e) {
    const selectedButton = e.target;
    const option = selectedButton.dataset.option;
    
    document.querySelectorAll('.option-btn').forEach(btn => {
        btn.classList.remove('selected');
    });
    
    selectedButton.classList.add('selected');
    selectedOption = option;
    nextButton.disabled = false;
}

// Check Quiz Answer
function checkAnswer() {
    const question = quizData[currentQuestion];
    const isCorrect = selectedOption === question.correct;
    
    if (isCorrect) {
        score += 5;
        scoreSpan.textContent = score;
        document.querySelector(`[data-option="${selectedOption}"]`).classList.add('correct');
        document.querySelector(`[data-option="${selectedOption}"]`).style.animation = 'correct-answer 0.5s';
        
        const celebration = document.createElement('div');
        celebration.className = 'celebration';
        celebration.innerHTML = 'ðŸŽ‰';
        document.querySelector('.card-body').appendChild(celebration);
        setTimeout(() => celebration.remove(), 1000);
    } else {
        document.querySelector(`[data-option="${selectedOption}"]`).classList.add('incorrect');
        document.querySelector(`[data-option="${question.correct}"]`).classList.add('correct');
        document.querySelector(`[data-option="${selectedOption}"]`).style.animation = 'incorrect-answer 0.5s';
    }
    
    document.querySelectorAll('.option-btn').forEach(btn => {
        btn.disabled = true;
    });
}

// Show Quiz Result
function showResult() {
    questionText.style.display = 'none';
    optionsContainer.style.display = 'none';
    nextButton.style.display = 'none';
    
    resultContainer.style.display = 'block';
    finalScoreSpan.textContent = score;
    maxScoreSpan.textContent = quizData.length * 5;
    
    let feedback = '';
    if (score >= 20) {
        feedback = 'Excellent! You have a strong understanding of cybersecurity basics.';
        document.querySelector('.cyber-trophy').style.animation = 'trophy-spin 2s ease';
    } else if (score >= 15) {
        feedback = 'Good job! You have a solid foundation in cybersecurity.';
    } else if (score >= 10) {
        feedback = 'Not bad! Keep learning to improve your cybersecurity knowledge.';
    } else {
        feedback = 'Keep practicing! Cybersecurity is an important skill to develop.';
    }
    
    feedbackDiv.textContent = feedback;
}

// Update Quiz Progress
function updateProgress() {
    const progress = ((currentQuestion + 1) / quizData.length) * 100;
    progressBar.style.width = `${progress}%`;
    currentQuestionSpan.textContent = currentQuestion + 1;
    totalQuestionsSpan.textContent = quizData.length;
}

// Load Code Challenge
function loadCodeChallenge(language) {
    currentLanguage = language;
    const challenge = codeChallenges[language];
    
    challengeDesc.textContent = challenge.description;
    
    // Set CodeMirror mode
    const modeMap = {
        'python': 'python',
        'javascript': 'javascript',
        'sql': 'sql'
    };
    
    codeEditor.setOption('mode', modeMap[language]);
    codeEditor.setValue(challenge.starterCode);
    
    // Clear previous output
    outputConsole.innerHTML = '';
    testResults.innerHTML = '';
    submitChallengeBtn.disabled = true;
}

// Run Code
function runCode() {
    const code = codeEditor.getValue();
    const challenge = codeChallenges[currentLanguage];
    
    outputConsole.innerHTML = '';
    
    try {
        if (currentLanguage === 'python') {
            runPythonCode(code, challenge);
        } else if (currentLanguage === 'javascript') {
            runJavaScriptCode(code, challenge);
        } else if (currentLanguage === 'sql') {
            runSQLCode(code, challenge);
        }
    } catch (error) {
        outputConsole.innerHTML += `<div class="text-danger">Error: ${error.message}</div>`;
    }
}

// Run Python Code
function runPythonCode(code, challenge) {
    // Simulate Python execution (in real implementation, this would be sent to backend)
    outputConsole.innerHTML += '<div class="text-info">Running Python code...</div>';
    
    // Simple validation for demonstration
    if (code.includes('def validate_password') && code.includes('return')) {
        outputConsole.innerHTML += '<div class="text-success">Code structure looks good!</div>';
        runTestCases(challenge.testCases, code);
    } else {
        outputConsole.innerHTML += '<div class="text-warning">Please implement the validate_password function</div>';
    }
}

// Run JavaScript Code
function runJavaScriptCode(code, challenge) {
    outputConsole.innerHTML += '<div class="text-info">Running JavaScript code...</div>';
    
    if (code.includes('function sanitizeInput') && code.includes('return')) {
        outputConsole.innerHTML += '<div class="text-success">Code structure looks good!</div>';
        runTestCases(challenge.testCases, code);
    } else {
        outputConsole.innerHTML += '<div class="text-warning">Please implement the sanitizeInput function</div>';
    }
}

// Run SQL Code
function runSQLCode(code, challenge) {
    outputConsole.innerHTML += '<div class="text-info">Running SQL code...</div>';
    
    if (code.includes('SELECT') && code.includes('?')) {
        outputConsole.innerHTML += '<div class="text-success">Secure parameterized query detected!</div>';
        runTestCases(challenge.testCases, code);
    } else {
        outputConsole.innerHTML += '<div class="text-warning">Please use parameterized queries to prevent SQL injection</div>';
    }
}

// Run Test Cases
function runTestCases(testCases, code) {
    testResults.innerHTML = '<h6 class="cyber-text">Test Results:</h6>';
    
    let passedTests = 0;
    
    testCases.forEach((testCase, index) => {
        const testDiv = document.createElement('div');
        testDiv.className = 'test-results';
        
        // Simple validation for demonstration
        let passed = false;
        if (currentLanguage === 'python') {
            passed = code.includes('def validate_password') && code.includes('return');
        } else if (currentLanguage === 'javascript') {
            passed = code.includes('function sanitizeInput') && code.includes('return');
        } else if (currentLanguage === 'sql') {
            passed = code.includes('SELECT') && code.includes('?');
        }
        
        if (passed) {
            passedTests++;
            testDiv.classList.add('test-pass');
            testDiv.innerHTML = `<span class="text-success">âœ“ Test ${index + 1} PASSED</span>`;
        } else {
            testDiv.classList.add('test-fail');
            testDiv.innerHTML = `<span class="text-danger">âœ— Test ${index + 1} FAILED</span>`;
        }
        
        testResults.appendChild(testDiv);
    });
    
    if (passedTests === testCases.length) {
        submitChallengeBtn.disabled = false;
        outputConsole.innerHTML += '<div class="text-success">All tests passed! You can submit your solution.</div>';
    }
}

// Reset Code
function resetCode() {
    const challenge = codeChallenges[currentLanguage];
    codeEditor.setValue(challenge.starterCode);
    outputConsole.innerHTML = '';
    testResults.innerHTML = '';
    submitChallengeBtn.disabled = true;
}

// Submit Challenge
function submitChallenge() {
    const code = codeEditor.getValue();
    const challenge = codeChallenges[currentLanguage];
    
    // In real implementation, this would be sent to backend for evaluation
    outputConsole.innerHTML += '<div class="text-success">ðŸŽ‰ Challenge completed successfully!</div>';
    outputConsole.innerHTML += '<div class="text-info">Your solution has been submitted and evaluated.</div>';
    
    // Show solution
    setTimeout(() => {
        outputConsole.innerHTML += '<div class="text-warning">--- Solution ---</div>';
        outputConsole.innerHTML += `<pre class="text-light">${challenge.solution}</pre>`;
    }, 2000);
}

// Create Particles
function createParticles() {
    const particlesContainer = document.querySelector('.cyber-particles');
    if (!particlesContainer) return;
    
    for (let i = 0; i < 20; i++) {
        const particle = document.createElement('div');
        particle.className = 'particle';
        particle.style.left = Math.random() * 100 + '%';
        particle.style.animationDelay = Math.random() * 3 + 's';
        particlesContainer.appendChild(particle);
    }
}

// Event Listeners
nextButton.addEventListener('click', () => {
    checkAnswer();
    
    if (currentQuestion < quizData.length - 1) {
        currentQuestion++;
        setTimeout(loadQuestion, 1000);
    } else {
        setTimeout(showResult, 1000);
    }
});

restartButton.addEventListener('click', () => {
    currentQuestion = 0;
    score = 0;
    scoreSpan.textContent = score;
    selectedOption = null;
    
    questionText.style.display = 'block';
    optionsContainer.style.display = 'grid';
    nextButton.style.display = 'block';
    resultContainer.style.display = 'none';
    
    loadQuestion();
});

challengeTypeSelect.addEventListener('change', (e) => {
    loadCodeChallenge(e.target.value);
});

runCodeBtn.addEventListener('click', runCode);
resetCodeBtn.addEventListener('click', resetCode);
submitChallengeBtn.addEventListener('click', submitChallenge);

// Initialize everything when page loads
document.addEventListener('DOMContentLoaded', () => {
    initQuiz();
    initCodeEditor();
});
</script>
{% endblock %} 