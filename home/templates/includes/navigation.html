

{% load static %}
{% load i18n %}
<header class="header-global">
  <nav id="navbar-main" aria-label="Primary navigation" class="navbar navbar-main navbar-expand-lg navbar-light">
    <div class="navbar-container position-relative">

      <!-- Brand -->
      <a class="navbar-brand me-lg-5" href="/">
        <img class="navbar-brand-dark" src="{% static 'assets/img/brand/logo.svg' %}" alt="Logo light" />
        <img class="navbar-brand-light" src="{% static 'assets/img/brand/logo.svg' %}" alt="Logo dark" />
      </a>

      <!-- Collapsible -->
      <div class="navbar-collapse collapse me-auto" id="navbar_global">
        <div class="navbar-collapse-header">
          <div class="row w-100 align-items-center">
            <div class="col-6 collapse-brand">
              <a href="/">
                <img src="{% static 'assets/img/brand/dark.svg' %}" alt="Themesberg logo" />
              </a>
            </div>
            <!-- (Dark mode toggle removed from header on purpose; moved to Settings) -->
            <div class="col-6 collapse-close text-end">
              <a href="#navbar_global" class="fas fa-times" data-bs-toggle="collapse" data-bs-target="#navbar_global"
                 aria-controls="navbar_global" aria-expanded="false" title="close" aria-label="Toggle navigation"></a>
            </div>
          </div>
        </div>

        <form class="mobile-search-bar" 
              method="POST" 
              action="{% url 'pages/search-results' %}">
          {% csrf_token %}
          <input class="form-control search-box-mobile" 
                 type="search" 
                 id="mobileSearchInput" 
                 name="q" 
                 placeholder="{% trans 'Search...' %}" 
                 aria-label="Search" 
                 autocomplete="off">
          <button class="search-btn-mobile" type="submit">
            <i class="fas fa-search search-icon"></i>
          </button>
        </form>
        <div class="mobile-result-box d-none"></div>

        <!-- Main nav -->
        <ul class="navbar-nav navbar-nav-hover align-items-lg-center">

          <!-- Home -->
          <li class="nav-item">
            <a href="{% url 'index' %}" class="nav-link">{% trans "Home" %}</a>
          </li>

          <!-- Upskilling (auth only) -->
          {% if user.is_authenticated %}
          <li class="nav-item dropdown">
            <a href="#" class="nav-link dropdown-toggle" id="upskillingDropdown" aria-expanded="false" data-bs-toggle="dropdown">
              {% trans "Upskilling" %}
              <span class="fas fa-angle-down nav-link-arrow ms-1"></span>
            </a>
            <div class="dropdown-menu pt-2" aria-labelledby="upskillingDropdown">
              <ul class="list-style-none">
                <a class="menu-link" href="{% url 'dashboard' %}">
                  <li class="mb-2 menu ps-3 py-1">{% trans "Dashboard" %}</li>
                </a>
                <a class="menu-link" href="{% url 'upskilling' %}">
                  <li class="mb-2 menu ps-3 py-1">{% trans "Skills" %}</li>
                </a>
              </ul>
            </div>
          </li>
          {% endif %}

          <!-- Vault (from main branch) -->
          {% if user.is_authenticated %}
          <li class="nav-item">
            <a href="{% url 'vault' %}" class="nav-link">{% trans "Vault" %}</a>
          </li>
          {% endif %}

          <!-- Admin (staff/superuser only) -->
          {% if user.is_authenticated %}
          {% if user.is_staff or user.is_superuser %}
          <li class="nav-item dropdown">
            <a href="#" class="nav-link dropdown-toggle" id="adminDropdown" aria-expanded="false" data-bs-toggle="dropdown">
              {% trans "Admin Settings" %}
              <span class="fas fa-angle-down nav-link-arrow ms-1"></span>
            </a>
            <div class="dropdown-menu pt-2" aria-labelledby="adminDropdown">
              <ul class="list-style-none">
                <a class="menu-link" href="#"><li class="mb-2 menu ps-3 py-1">{% trans "User Management" %}</li></a>
                <a class="menu-link" href="#"><li class="mb-2 menu ps-3 py-1">{% trans "Project Assignment" %}</li></a>
                <a class="menu-link" href="#"><li class="mb-2 menu ps-3 py-1">{% trans "Project Teams" %}</li></a>
                <a class="menu-link" href="{% url 'adminblogpage' %}"><li class="mb-2 menu ps-3 py-1">{% trans "Review Blogs" %}</li></a>
                <a class="menu-link" href="{% url 'reports' %}"><li class="mb-2 menu ps-3 py-1">{% trans "Reports" %}</li></a>
              </ul>
            </div>
          </li>
          {% endif %}
          {% endif %}

          <!-- About -->
          <li class="nav-item">
            <a href="{% url 'about_us' %}" class="nav-link">{% trans "About" %}</a>
          </li>

          <!-- Projects (enhanced version from main) -->
          <li class="nav-item dropdown">
            <a class="nav-link" href="#" id="blogDropdown" data-bs-toggle="dropdown" aria-expanded="false">
              {% trans "Projects" %}
              <span class="fas fa-angle-down nav-link-arrow ms-1"></span>
            </a>
            <div class="dropdown-menu pt-2" style="width: max-content !important;margin-left: 50px;" aria-labelledby="blogDropdown">
              <div class="row">
                <div class="col">
                  <ul class="list-style-none m-0 p-0">

                    <li class="menu ps-3 py-2">
                      <a class="nav-link d-block px-2 py-2 project-nav-link" href="{% url 'appattack' %}" style="display:table;width:100%;">
                        <span class="nav-icon" style="display:table-cell; width:32px; height:32px; background:#FFCD11;mask:url('{% static 'icons/appattack.svg' %}') no-repeat center / contain;vertical-align:middle;text-align:center;"></span>
                        <span style="display:table-cell;vertical-align:middle;padding-left:8px;">
                          <div class="fw-semibold">{% trans "AppAttack" %}</div>
                          <div class="small">{% trans "Offensive security assessment tool" %}</div>
                        </span>
                      </a>
                    </li>

                    <li class="menu ps-3 py-2">
                      <a class="nav-link d-block px-2 py-2 project-nav-link" href="{% url 'malware_viz_main' %}" style="display:table;width:100%;">
                        <span class="nav-icon" style="display:table-cell; width:32px; height:32px; background:#FFCD11;mask:url('{% static 'icons/malware.svg' %}') no-repeat center / contain;vertical-align:middle;text-align:center;"></span>
                        <span style="display:table-cell;vertical-align:middle;padding-left:8px;">
                          <div class="fw-semibold">{% trans "Malware" %}</div>
                          <div class="small">{% trans "Malware research and visualization" %}</div>
                        </span>
                      </a>
                    </li>          

                    <li class="menu ps-3 py-2">
                      <a class="nav-link d-block px-2 py-2 project-nav-link" href="{% url 'ptgui_viz_main' %}" style="display:table;width:100%;">
                        <span class="nav-icon" style="display:table-cell; width:32px; height:32px; background:#FFCD11;mask:url('{% static 'icons/pentesting.svg' %}') no-repeat center / contain;vertical-align:middle;text-align:center;"></span>
                        <span style="display:table-cell;vertical-align:middle;padding-left:8px;">
                          <div class="fw-semibold">{% trans "PT-GUI" %}</div>
                          <div class="small">{% trans "Visual penetration testing dashboard" %}</div>
                        </span>
                      </a>
                    </li>
                    
                    <li class="menu ps-3 py-2">
                      <a class="nav-link d-block px-2 py-2 project-nav-link" href="{% url 'smishing_detection_main' %}" style="display:table;width:100%;">
                        <span class="nav-icon" style="display:table-cell; width:32px; height:32px; background:#FFCD11;mask:url('{% static 'icons/phishing.svg' %}') no-repeat center / contain;vertical-align:middle;text-align:center;"></span>
                        <span style="display:table-cell;vertical-align:middle;padding-left:8px;">
                          <div class="fw-semibold">{% trans "Smishing Detection" %}</div>
                          <div class="small">{% trans "SMS phishing detection system" %}</div>
                        </span>
                      </a>
                    </li>

                    <li class="menu ps-3 py-2">
                      <a class="nav-link d-block px-2 py-2 project-nav-link" href="{% url 'Vr_main' %}" style="display:table;width:100%;">
                        <span class="nav-icon" style="display:table-cell; width:32px; height:32px; background:#FFCD11;mask:url('{% static 'icons/vr-cyber.svg' %}') no-repeat center / contain;vertical-align:middle;text-align:center;"></span>
                        <span style="display:table-cell;vertical-align:middle;padding-left:8px;">
                          <div class="fw-semibold">{% trans "Deakin CyberSafe VR" %}</div>
                          <div class="small">{% trans "VR Cyber safety project" %}</div>
                        </span>
                      </a>
                    </li>

                    <li class="menu ps-3 py-2">
                      <a class="nav-link d-block px-2 py-2 project-nav-link" href="{% url 'Deakin_Threat_mirror_main' %}" style="display:table;width:100%;">
                        <span class="nav-icon" style="display:table-cell; width:32px; height:32px; background:#FFCD11;mask:url('{% static 'icons/threat.svg' %}') no-repeat center / contain;vertical-align:middle;text-align:center;"></span>
                        <span style="display:table-cell;vertical-align:middle;padding-left:8px;">
                          <div class="fw-semibold">{% trans "Threat mirror" %}</div>
                          <div class="small">{% trans "Threat Detection Framework" %}</div>
                        </span>
                      </a>
                    </li>

                    <li class="menu ps-3 py-2">
                      <a class="nav-link d-block px-2 py-2 project-nav-link" href="{% url 'policy_deployment' %}" style="display:table;width:100%;">
                        <span class="nav-icon" style="display:table-cell; width:32px; height:32px; background:#FFCD11;mask:url('{% static 'icons/policy.svg' %}') no-repeat center / contain;vertical-align:middle;text-align:center;"></span>
                        <span style="display:table-cell;vertical-align:middle;padding-left:8px;">
                          <div class="fw-semibold">{% trans "The Policy Deployment Engine" %}</div>
                          <div class="small">{% trans "Automated policy enforcement engine" %}</div>
                        </span>
                      </a>
                    </li>
                  </ul>
                </div>
              </div>
          </li>
            
            <!-- Resources -->
            <li class="nav-item">
              <a class="nav-link" href="{% url 'resources' %}">Resources</a>
            </li>

          <!-- Blog -->
          <li class="nav-item dropdown">
            <a class="nav-link" href="#" id="blogDropdown" data-bs-toggle="dropdown" aria-expanded="false">
              {% trans "Blog" %}
              <span class="fas fa-angle-down nav-link-arrow ms-1"></span>
            </a>
            <div class="dropdown-menu pt-2" aria-labelledby="blogDropdown">
              <div class="row">
                <div class="col">
                  <ul class="list-style-none">
                    {% if user.is_authenticated %}
                      <li class="mb-2 menu ps-3 py-1"><a class="menu-link" href="{% url 'blogpage' %}">{% trans "Create a Blog" %}</a></li>
                    {% endif %}
                    <li class="mb-2 menu ps-3 py-1"><a class="menu-link" href="{% url 'publishedblog' %}">{% trans "Published Blogs" %}</a></li>
                  </ul>
                </div>
              </div>
            </div>
          </li>

          <!-- Careers -->

          <li class="nav-item dropdown">
            <a class="nav-link" href="#" id="careersDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
              {% trans "Careers" %}
              <span class="fas fa-angle-down nav-link-arrow ms-1"></span>
            </a>
            <div class="dropdown-menu pt-2" aria-labelledby="careersDropdown">
              <ul class="list-style-none">
                <a class="menu-link" href="{% url 'career-discover' %}">
                  <li class="mb-2 menu ps-3 py-1">{% trans "Discover Hardhat" %}</li>
                </a>
                <a class="menu-link" href="{% url 'career-list' %}">
                  <li class="mb-2 menu ps-3 py-1">{% trans "All Jobs" %}</li>
                </a>

                <a class="menu-link" href="{% url 'graduate-program' %}">
                  <li class="mb-2 menu ps-3 py-1">{% trans "Graduate Program" %}</li>
                </a>

                <a class="menu-link" href="{% url 'internships' %}">
                  <li class="mb-2 menu ps-3 py-1">{% trans "Internships" %}</li>
                </a>
                <a class="menu-link" href="{% url 'job-alerts' %}">
                  <li class="mb-2 menu ps-3 py-1">{% trans "Job Alerts" %}</li>
                </a>
                <a href="{% url 'career_path_finder' %}">
                  <li class="mb-2 menu ps-3 py-1">{% trans "Career Path Finder" %}</li>
                </a>
              </ul>
            </div>
          </li>

          <!-- Cyber Challenges -->
          <li class="nav-item dropdown">
            <a href="#" class="nav-link" id="frontPagesDropdown" aria-expanded="false" data-bs-toggle="dropdown">
              {% trans "Cyber Challenges" %}
              <span class="fas fa-angle-down nav-link-arrow ms-1"></span>
            </a>
            <div class="dropdown-menu pt-2" aria-labelledby="frontPagesDropdown">
              <ul class="list-style-none">
                <a class="menu-link" href="{% url 'challenge_list' %}">
                  <li class="mb-2 menu ps-3 py-1">
                    {% trans "All Challenges" %}
                  </li>
                </a>
                <a class="menu-link" href="{% url 'cyber_quiz' %}">
                  <li class="mb-2 menu ps-3 py-1">
                    {% trans "Quiz" %}
                  </li>
                </a>
                <a class="menu-link" href="{% url 'cyber_match' %}">
                  <li class="mb-2 menu ps-3 py-1">
                    {% trans "Match" %}
                  </li>
                </a>
              </ul>
            </div>
          </li>

          <!-- Desktop search -->
          <div class="search-container position-relative">
            <form class="desktop-search-bar" method="POST" action="{% url 'pages/search-results' %}">
              {% csrf_token %}
              <input class="form-control me-4 search-box" type="search" id="searchInput" name="q"
                     placeholder="{% trans 'Search...' %}" aria-label="Search" autocomplete="off">
              <button class="search-btn" type="submit">
                <div><i class="fas fa-search search-icon"></i></div>
              </button>
            </form>
            <div class="result-box d-none"></div>
          </div>

          <!-- RIGHT SIDE: Auth / Profile (your settings feature) -->
          {% url 'settings' as settings_url %}
          <li class="nav-item dropdown ms-lg-3">
            {% if user.is_authenticated %}
              <a class="nav-link dropdown-toggle d-flex align-items-left" href="#" id="profileDropdown"
                role="button" data-bs-toggle="dropdown" data-bs-display="static" aria-expanded="false">

                {% if request.user.profile.avatar %}
                  <img
                    src="{{ request.user.profile.avatar.url }}"
                    class="rounded-circle me-2" width="32" height="32" alt="User Profile Picture">
                {% else %}
                  <div class="rounded-circle me-2 d-flex align-items-center justify-content-center bg-secondary text-white" 
                       style="width: 32px; height: 32px;">
                    <i class="fas fa-user"></i>
                  </div>
                {% endif %}
                <span class="d-none d-lg-inline header-profile-name">
                  {{ request.user.first_name }} {{ request.user.last_name }}
                </span>
              </a>
              <ul class="dropdown-menu dropdown-menu-end shadow text-center" aria-labelledby="profileDropdown">
                <li>
                  <a class="dropdown-item fw-semibold py-2" href="{% url 'profile' %}">
                    <i class="bi bi-person me-2"></i> Profile
                  </a>
                </li>
                {% if settings_url %}
                <li>
                  <a class="dropdown-item fw-semibold py-2" href="{{ settings_url }}">
                    <i class="bi bi-gear me-2"></i> Settings
                  </a>
                </li>
                {% endif %}
                <li><hr class="dropdown-divider"></li>
                <li>
                  <form method="post" action="{% url 'logout' %}" class="px-3 py-1">
                    {% csrf_token %}
                    <button class="btn btn-sm btn-danger w-100 fw-semibold" type="submit">
                      <i class="bi bi-box-arrow-right me-2"></i> Logout
                    </button>
                  </form>
                </li>
              </ul>


            {% else %}
              <a class="btn btn-outline-gray-100 me-2" href="{% url 'login_with_otp' %}">
                <span class="fas fa-sign-in-alt me-2"></span> Sign In
              </a>
              <a class="btn btn-outline-gray-100" href="{% url 'register' %}">
                <span class="fas fa-user-plus me-2"></span> Sign Up
              </a>
            {% endif %}
          </li>

        </ul>
      </div>

      <!-- Right side: Auth buttons (guests only) + Hamburger -->
      <div class="d-flex align-items-center justify-content-center">

        <!-- Toggler -->
        <span class="hamburger-button-menu ms-2" type="button" data-bs-toggle="collapse"
              data-bs-target="#navbar_global" aria-controls="navbar_global" aria-expanded="false"
              aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </span>

        <!-- language switcher -->
        <div class="dropdown" style="margin-left:10px;margin-right:5px;">
          {% get_current_language as CURRENT_LANG %}
          {% with code=CURRENT_LANG|lower|slice:":2" %}
          <button class="nav-link dropdown-toggle btn btn-link p-0"
                  id="langDropdown"
                  data-bs-toggle="dropdown"
                  aria-expanded="false"
                  title="{% trans 'Language' %}"
                  type="button">
            {% if code == "en" %}
              üåê
            {% elif code == "es" %}
              <img class="flag-icon" src="{% static 'images/flags/es.png' %}" alt="Espa√±ol">
            {% elif code == "zh" %}
              <img class="flag-icon" src="{% static 'images/flags/cn.png' %}" alt="ÁÆÄ‰Ωì‰∏≠Êñá">
            {% elif code == "fr" %}
              <img class="flag-icon" src="{% static 'images/flags/fr.png' %}" alt="Fran√ßais">
            {% elif code == "ja" %}
              <img class="flag-icon" src="{% static 'images/flags/jp.png' %}" alt="Êó•Êú¨Ë™û">
            {% elif code == "ko" %}
              <img class="flag-icon" src="{% static 'images/flags/kr.png' %}" alt="ÌïúÍµ≠Ïñ¥">
            {% else %}
              üåê
            {% endif %}
          </button>
          {% endwith %}

          <ul id="lang_menu" class="dropdown-menu dropdown-menu-end" aria-labelledby="langDropdown">
            <li><a class="dropdown-item d-flex align-items-center lang-choice" href="#" data-lang="en">
              <img class="flag-icon me-2" src="{% static 'images/flags/us.png' %}" alt="English"> English
            </a></li>
            <li><a class="dropdown-item d-flex align-items-center lang-choice" href="#" data-lang="es">
              <img class="flag-icon me-2" src="{% static 'images/flags/es.png' %}" alt="Espa√±ol"> Espa√±ol
            </a></li>
            <li><a class="dropdown-item d-flex align-items-center lang-choice" href="#" data-lang="zh-hans">
              <img class="flag-icon me-2" src="{% static 'images/flags/cn.png' %}" alt="ÁÆÄ‰Ωì‰∏≠Êñá"> ÁÆÄ‰Ωì‰∏≠Êñá
            </a></li>
            <li><a class="dropdown-item d-flex align-items-center lang-choice" href="#" data-lang="fr">
              <img class="flag-icon me-2" src="{% static 'images/flags/fr.png' %}" alt="Fran√ßais"> Fran√ßais
            </a></li>
            <li><a class="dropdown-item d-flex align-items-center lang-choice" href="#" data-lang="ja">
              <img class="flag-icon me-2" src="{% static 'images/flags/jp.png' %}" alt="Êó•Êú¨Ë™û"> Êó•Êú¨Ë™û
            </a></li>
            <li><a class="dropdown-item d-flex align-items-center lang-choice" href="#" data-lang="ko">
              <img class="flag-icon me-2" src="{% static 'images/flags/kr.png' %}" alt="ÌïúÍµ≠Ïñ¥"> ÌïúÍµ≠Ïñ¥
            </a></li>
          </ul>
        </div>

        <form id="set-lang-form" action="{% url 'set_language' %}" method="post" class="d-none">
          {% csrf_token %}
          <input type="hidden" name="next" value="{{ request.get_full_path }}">
          <input type="hidden" name="language" id="lang-input">
        </form>

      </div>
    </div>
  </nav>
</header>

<style>
  .flag-icon{
    width: 30px;
    height: 21px;
    object-fit: cover;
    flex-shrink: 0;
    margin-right: 10px;
    display: inline-block;
    vertical-align: middle;
    border-radius: 2px;
  }

  .dropdown-menu#lang_menu {
    background-color: #fff !important;
    border: 1px solid #ccc !important;
    border-radius: 4px !important;
    box-shadow: 0 2px 6px rgba(0,0,0,.15) !important;
    padding: 0 !important;
    margin-top: 0.5rem !important;
    min-width: auto !important;
    width: auto !important;
  }

  .dropdown-menu#lang_menu .dropdown-item {
    color: #4B5868 !important;
    font-weight: 500;
    padding: 0.5rem 0.8rem !important;
    padding-right: 1.2rem !important;
    background-color: transparent !important;
    border-bottom: 1px solid #eee;
    display: flex !important;
    align-items: center;
    justify-content: flex-start;
  }

  .dropdown-menu#lang_menu .dropdown-item:last-child {
    border-bottom: none;
  }

  .dropdown-menu#lang_menu .dropdown-item:hover,
  .dropdown-menu#lang_menu .dropdown-item:focus {
    background-color: #1967D2 !important;
    color: #fff !important;
  }

  .dropdown-menu#lang_menu .dropdown-item.active {
    background-color: #ffcd11 !important;
    color: #fff !important;
  }

  #langDropdown img.flag-icon {
    filter: none !important;
    opacity: 1 !important;
  }

  /* Your z-index fixes */
  .header-global,
  #navbar-main,
  .navbar-container,
  .navbar {
    position: relative;
    z-index: 3000;
    overflow: visible !important;
  }

  #navbar-main .dropdown-menu {
    z-index: 4000 !important;
  }

  .result-box,
  .mobile-result-box {
    z-index: 1500;
  }

  .navbar-collapse,
  .navbar-nav,
  .search-container {
    overflow: visible !important;
  }

  /* Force dropdown text to be visible */
  .dropdown-menu {
    background-color: #fff !important;
  }
  .dropdown-menu .dropdown-item {
    color: #000 !important;
  }
  .dropdown-menu .dropdown-item:hover {
    background-color: #f2f2f2 !important;
    color: #000 !important;
  }
  .dropdown-menu .dropdown-item {
    text-align: left;
    font-weight: 600;
  }

  .header-profile-name { color: #1a1a1a !important; }
  body.dark-mode .header-profile-name { color: #fff !important; }

  .dropdown-submenu {
    position: relative;
  }

  .submenu {
    display: none;
    top: 0;
    left: 100%;
    margin-top: -1px;
    border-radius: 0.25rem;
    z-index: 1000;
  }

  .dropdown-submenu.show > .submenu {
    display: block;
  }

  /* Force navbar text to always be yellow */
.navbar-nav .nav-link {
  color: #ffc107 !important;
}

.navbar-nav .nav-link:hover,
.navbar-nav .nav-link:focus {
  color: #ffcd39 !important;
}

/* Dropdown arrows */
.nav-link-arrow {
  color: #ffc107 !important;
}

/* Override any theme-specific colors */
body.light-mode .navbar-nav .nav-link,
body.dark-mode .navbar-nav .nav-link {
  color: #ffc107 !important;
}

/* Make both Sign In and Sign Up buttons consistent with yellow styling */
.btn-primary,
.btn-outline-gray-100 {
  background-color: transparent !important;
  border: 2px solid #ffc107 !important;
  color: #ffc107 !important;
}

.btn-primary:hover,
.btn-outline-gray-100:hover {
  background-color: #ffc107 !important;
  border-color: #ffc107 !important;
  color: #000 !important;
}
</style>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const form  = document.getElementById('set-lang-form');
    const input = document.getElementById('lang-input');
    document.querySelectorAll('.dropdown-item.lang-choice[data-lang]').forEach(a => {
      a.addEventListener('click', function (e) {
        e.preventDefault();
        input.value = this.dataset.lang;
        form.submit();
      });
    });
  });
</script>

<script src="{% static 'js/search_suggestions.js' %}"></script>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const blogPagePlus = document.getElementById('blogPagePlus');
    if (!blogPagePlus) return;

    const parentSubmenu = blogPagePlus.closest('.dropdown-submenu');

    // Prevent Bootstrap auto-close on click inside dropdown
    document.querySelectorAll('.dropdown-menu').forEach(menu => {
      menu.addEventListener('click', function (e) {
        e.stopPropagation();
      });
    });

    // Bootstrap fix: Stop parent from closing when submenu toggles
    document.querySelectorAll('.dropdown').forEach(drop => {
      drop.addEventListener('hide.bs.dropdown', function (e) {
        if (parentSubmenu.classList.contains('show')) {
          e.preventDefault(); // prevent closing if submenu is open
          parentSubmenu.classList.remove('show'); // manually close submenu
        }
      });
    });

    // Toggle submenu on Blog Page + click
    blogPagePlus.addEventListener('click', function (e) {
      e.preventDefault();
      e.stopPropagation();

      // Close all other open submenus
      document.querySelectorAll('.dropdown-submenu').forEach(sub => {
        if (sub !== parentSubmenu) sub.classList.remove('show');
      });

      // Toggle current submenu
      parentSubmenu.classList.toggle('show');
    });

    // Close submenu if clicked outside the entire dropdown
    document.addEventListener('click', function (e) {
      if (!parentSubmenu.contains(e.target)) {
        parentSubmenu.classList.remove('show');
      }
    });
  });
</script>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const adminReviewDropdown = document.getElementById('adminReviewDropdown');
    if (!adminReviewDropdown) return;

    const adminSubmenu = adminReviewDropdown.closest('.dropdown-submenu');

    adminReviewDropdown.addEventListener('click', function (e) {
      e.preventDefault();
      e.stopPropagation();

      // Close other open submenus
      document.querySelectorAll('.dropdown-submenu').forEach(item => {
        if (item !== adminSubmenu) item.classList.remove('show');
      });

      adminSubmenu.classList.toggle('show');
    });

    document.addEventListener('click', function (e) {
      if (!adminSubmenu.contains(e.target)) {
        adminSubmenu.classList.remove('show');
      }
    });
  });
</script>
